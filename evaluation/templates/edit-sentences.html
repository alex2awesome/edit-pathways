<HTMLQuestion xmlns="http://mechanicalturk.amazonaws.com/AWSMechanicalTurkDataSchemas/2011-11-11/HTMLQuestion.xsd">
<HTMLContent><![CDATA[

<!-- YOUR HTML BEGINS -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
</head>
<link type="text/css" href="https://getbootstrap.com/1.0.0/assets/css/bootstrap-1.0.0.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://creativecouple.github.io/jquery-timing/jquery-timing.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
<!-- ContextMenu -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.ui.position.js"></script>

<!-- alertify -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/alertify.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/alertify.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/themes/bootstrap.min.css">
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/css/themes/default.css"> -->

<script src="https://cdn.jsdelivr.net/gh/qiao/difflib.js/dist/difflib-browser.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/musclesoft/jquery-connections/jquery.connections.js"></script>

<style>

.example{
    background-color: #d7d7d7;
    margin-left: 20px;
    margin-right: 50px;
    padding: 10px;
    padding-bottom: 1px;
    margin-bottom: 10px;
}

.highlighted {
	background-color: yellow;
}

.text-mouseover{
	border-style: solid;
}

/* Handle the question text-boxes */
.textblock {
  border-radius: 4px;
  color: black;
  background: rgba(237, 245, 241, 0.87);
  display: inline-block;
  border: 2px solid Black;
  padding: 5px 10px 5px 10px;
  z-index: 1;
  position: relative;
}

.textblock-potential {
  /*border-radius: 4px;*/
  /*color: black;*/
  /*background: rgba(237, 245, 241, 0.87);*/
  /*display: inline-block;*/
  /*border: 2px solid Black;*/
  z-index: 2;
  position: relative;
  padding: 5px 10px 5px 10px;
}

.textblock-potential-active{
    background-color: rgba(102, 193, 102, 0.61);
    margin: 10px;
    border-radius: 4px;
}

.textblock-potential-row {
    background-color: rgba(84, 148, 173, 0.73);
    margin: 10px;
    height: 30px;
    border-radius: 4px;
}

.textblock-row{
    background-color: rgba(128, 128, 128, 0.56);
    margin: 10px;
    border-radius: 4px;
}

.textblock-snap{
    background-color: rgba(255, 0, 0, 0.41);
    margin: 10px 10px 10px 10px;
    border-radius: 4px;
}

.deleted-text-div{
    position: relative;
    padding: 5px 10px 5px 10px;
    border: 2px solid Black;
    border-radius: 4px;

}

.deleted-text{
    color: rgba(0, 0, 0, 0.58);
    text-decoration: line-through;
}

.textblock_pool {
	height: 200px;
}

.textblock_span {
	padding-right: 10px;
}

.shaded {
	border-color: #55f;
    /*border-radius: 20px;*/
    /*border-width: 5px;*/
}

#submitButton{
    z-index: 5;
}

#feedback{
    width: 100%;
}

hr.hr-medium{
    border: 3px solid black;
}

body{
    margin: 10px !important;
}


.color-none{
    background-color: transparent;
    color: transparent;
}

.hidden {
    /*transition: opacity 1s ease-out;*/
    /*opacity: 0;*/
    /*height: 0;*/
    /*overflow: hidden;*/
    /*color: white;*/
    visibility: hidden;
}

.hidden-none{
    display: None;
}


/*.hidden{*/
/*    display: none;*/
/*}*/


</style>
<!-- jquery connections -->
<body>


<form name='mturk_form' method='post' id='mturk_form' action='/mturk/externalSubmit'>
<input type='hidden' value='' name='assignmentId' id='assignmentId'/>

<div class="table table-hover container">
    <div class="row instructions">
        <div class="col-12">
            <div id="accordion">
              <div class="card">
                <div class="card-header" id="hello_header">
                  <h5 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#hello">
                      Hello, about us, and thank you for your help!
                    </button>
                  </h5>
                </div>
                <div id="hello" class="collapse show" aria-labelledby="hello_header" data-parent="#accordion">
                  <div class="card-body">
                    Hello! We are small research lab in University of Southern California trying to build AI tools to help
                    citizens better understand the work journalists do.
                    <br><br>
                    We are calibrating our payment scheme <b>to meet a $15 per hour wage and will reward workers who take time
                    to give correct answers</b>.
                    <br><br>
                    If you perform well, we will invite you to participate in future, well-paying trials. If you speed through and give nonsense
                    answers, <b>we will block you and report to Mechanical Turk</b>. We understand the pressures of Mechanical Turk, but we are a
                    small lab and cannot afford to throw out too much data.
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" id="headingOne">
                  <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" type="button" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                      Instructions
                    </button>
                  </h5>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                        <h2>Goals and Overview</h2>
                        <p>The goal of this exercise is to help us identify sentences in an article-rewrite that contain substantially new information.</p>
                        <p>To do this, you will identiy which sentences <b><i>match</i></b> between two versions of an article.</p>
                        <p>
                        <h4>Two sentences <b><i>match</i></b> if:</h4>
                            <ul>
                                <li><b><i>Option 1:</i></b> They are nearly the same, word-for-word.</li>
                                <li><b><i>Option 2:</i></b> They convey the same information but are <u>stylistically different.</u></li>
                                <li><b><i>Option 3:</i></b> They have slightly different information but have <u>substantial overlap in meaning</u> and <u>narrative function.</u></li>
                            </ul>
                        </p>

                        Examples of <b><i>Option 3</i></b> include (please see the "Examples" section for real examples):
                        <ul>
                            <li>Updating events.
                                <ul>
                                    <li>(Ex) <i>The man was presumed missing. &rarr; The man was found in his home.</i></li>
                                    <li>(Ex) <i>The death count was at 23. &rarr; 50 were found dead.</i></li>
                                    <li>(Ex) <i>The senators are still negotiating the details. &rarr; The senators have reached a deal.</i></li>
                                </ul>
                            </li>
                            <li>An improved analysis.
                                <ul>
                                    <li>(Ex) <i>The president is likely seeking improved relations. &rarr; The president is likely hoping that hard-liners will give way to moderates, improving relations.</i></li>
                                    <li>(Ex) <i>The storm, a Category IV, is expected to hit Texas. &rarr; The storm, downgraded to Category III, is projected to stay mainly in the Gulf.</i></li>
                                    <li>(Ex) <i>Analysts widely think the shock will be temporary. &rarr; The shock, caused by widespread shipping delays, might last into December, but will ultimately subside.</i></li>
                                </ul>
                            </li>
                            <li>A quote that is very similar or serves the same purpose.
                                <ul>
                                    <li>(Ex) <i>"We knew we had to get it done." said Senator Murphy. &rarr; "At the end of the day, no one could leave until we had a deal" said Senator Harris.</i></li>
                                    <li>(Ex) <i>"It was gripping." said the bystander. &rarr; "I couldn't stop watching." said a moviegoer.</i></li>
                                </ul>
                            </li>
                        </ul>

                        <p>
                        <h4>Two sentences <b><i>do not match</i></b> if:</h4>
                            <ul>
                                <li>They contain substantially different information.</li>
                                <li>They serve different narrative functions.</li>
                                <li>There is a much better match for one sentence somewhere else in the document.</li>
                            </ul>
                        </p>
                        <p>
                        <h4>Things to keep in mind:</h4>
                            <ul>
                                <li>Two sentences might match <u>even if they are in different parts of the document.</u></li>
                                <li>One sentence can match <u>with multiple other sentences</u>, because that sentence might be split up into multiple sentences, each with similar information as parts of the original.</li>
                                <li>Sentences <i>don't have to match</i>.
                                    <ul>
                                        <li>Substantially new information, perspectives or narrative tools might be added in a new version.</li>
                                        <li>Substantially old information, perspectives or narrative tools might be removed from an old version.</li>
                                    </ul>
                                </li>
                            </ul>
                        </p>

                        <h4>Steps to completing the task:</h4>
                        <ol>
                            <li>For each sentence in the left-hand column, determine if its <b><i>matches</i></b> with a sentence on the right.
                                <ul>
                                    <li>By mousing over the sentence block, you will see word-overlaps between the moused-over block and all blocks in the opposite column.
                                        <b>THIS IS MEANT TO BE HELPFUL BUT NOT COMPLETE.</b> Please do not rely on this alone.
                                        We expect that many sentences with high word-overlap still might convey different information.
                                        <i>We will be checking answers for completeness!!</i></li>
                                    <li>If you find two blocks that look very similar but are not exactly the same, ask yourself: is there substantially new information included?
                                        Or is the edit merely cosmetic?</li>
                                </ul>
                            </li>
                            <li>When you find blocks that you think should match - i.e. they contain the same, or substantially similar information - connect them by:
                                (a) right-clicking on the first block and (b) right clicking on it's matching block</li>
                            <li>If you right-click on a block accidentally, you may right-click on the same block to remove the line.</li>
                            <li>Please note, <i>there may be blocks that do not match!!</i> This is OK.</li>
                        </ol>
                    </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" id="headingOne">
                  <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" type="button" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                      Video
                    </button>
                  </h5>
                </div>
                <div id="collapseFour" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">

                                        <p>
                            <video width="320" height="240" controls>
                              <source src="https://storage.googleapis.com/public-mturk-resources/sped-up-2.mov" type="video/mp4">
                            Your browser does not support the video tag.
                            </video>
                        </p>
                    </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" id="headingOne">
                  <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" type="button" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                      Examples
                    </button>
                  </h5>
                </div>
                <div id="collapseThree" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                        In the examples below, we'll show sentence pairs that we consider matches. The sentence(s) from the old version will occur first, followed by the sentence(s) from the new version. Green text is text that has been added (i.e. it is specific the new version) and red text is text that has been remove (i.e. it is specific to the old version).

                        <h4>Sentences that contain the same information:</h4>
                        <p>The following sentences convey the same information, however, they are cosmetically different.</p>


                        <h5>Example 1</h5>
                        <p><i>This is a sentence pair where only a few style edits have been made.</i></p>

                        <div class="example">
                            <p>ZABUL , Afghanistan — A complex attack on a military base in southern Afghanistan Monday <span style="background-color:rgba(255,0,0,0.3)">left</span>  at least one member of  U.S.-led coalition forces <span style="background-color:rgba(255,0,0,0.3)">dead</span>. &rarr;</p>
                            <hr>
                            <p>ZABUL , Afghanistan — A complex attack on a military base in southern Afghanistan Monday  <span style="background-color:rgba(0,255,0,0.3)">killed </span> at least one member of <span style="background-color:rgba(0,255,0,0.3)">the </span> U.S.-led coalition forces.</p>
                        </div>

                        <h4>Sentences that match in meaning/purpose:</h4>
                        <h5>Example 1</h5>
                        <p><i>This is a sentence pair where an <u>event update</u> has occurred. The man went from being "suspected" of a crime to being confirmed as committing it.</i></p>

                        <div class="example">
                            <p>TAIPEI , Taiwan —  <span style="background-color:rgba(255,0,0,0.3)">Police</span> <span style="background-color:rgba(255,0,0,0.3)">officials</span> <span style="background-color:rgba(255,0,0,0.3)">in</span> <span style="background-color:rgba(255,0,0,0.3)">China</span> <span style="background-color:rgba(255,0,0,0.3)">said</span> <span style="background-color:rgba(255,0,0,0.3)">Thursday</span> <span style="background-color:rgba(255,0,0,0.3)">that</span> <span style="background-color:rgba(255,0,0,0.3)">they</span> <span style="background-color:rgba(255,0,0,0.3)">arrested</span> <span style="background-color:rgba(255,0,0,0.3)">a</span> man   <span style="background-color:rgba(255,0,0,0.3)">suspected</span> <span style="background-color:rgba(255,0,0,0.3)">of</span> <span style="background-color:rgba(255,0,0,0.3)">stabbing</span> <span style="background-color:rgba(255,0,0,0.3)">to</span> <span style="background-color:rgba(255,0,0,0.3)">death</span> six nurses and a manager   at a Chinese military <span style="background-color:rgba(255,0,0,0.3)">sanitarium</span>  in a seaside area famous for gatherings of Communist Party leaders.&rarr;</p>
                            <hr>
                            <p>TAIPEI , Taiwan — <span style="background-color:rgba(0,255,0,0.3)">A </span>           man <span style="background-color:rgba(0,255,0,0.3)">fatally </span> <span style="background-color:rgba(0,255,0,0.3)">stabbed </span>      six nurses and a manager <span style="background-color:rgba(0,255,0,0.3)">on </span> <span style="background-color:rgba(0,255,0,0.3)">Thursday </span> at a Chinese military  <span style="background-color:rgba(0,255,0,0.3)">hospital </span> in a seaside area famous for gatherings of Communist Party leaders <span style="background-color:rgba(0,255,0,0.3)">, </span> <span style="background-color:rgba(0,255,0,0.3)">police </span> <span style="background-color:rgba(0,255,0,0.3)">officials </span> <span style="background-color:rgba(0,255,0,0.3)">in </span> <span style="background-color:rgba(0,255,0,0.3)">China </span> <span style="background-color:rgba(0,255,0,0.3)">said </span> .</p>
                        </div>

                        <h5>Example 2</h5>
                        <p><i>This is a sentence group where one long sentence has been split into multiple sentences. While there is extra information added (e.g. one sentence adds "about 180 miles east of Beijing"), it is mainly
                        descriptive and the purpose of the sentences (i.e. to describe the crime further and give background for the reader) are the same.
                        </i></p>
                        <div class="example">
                            <p>The <span style="background-color:rgba(255,0,0,0.3)">police</span>                           said <span style="background-color:rgba(255,0,0,0.3)">the</span> <span style="background-color:rgba(255,0,0,0.3)">suspect</span> in <span style="background-color:rgba(255,0,0,0.3)">the</span> <span style="background-color:rgba(255,0,0,0.3)">killings</span>         Thursday morning in Beidaihe , a resort area in the Hebei Province city of Qinhuangdao ,                  is  <span style="background-color:rgba(255,0,0,0.3)">a</span> <span style="background-color:rgba(255,0,0,0.3)">sanitarium</span> employee <span style="background-color:rgba(255,0,0,0.3)">,</span> <span style="background-color:rgba(255,0,0,0.3)">indicating</span>   the attack was <span style="background-color:rgba(255,0,0,0.3)">likely</span>  not the result of a dispute over a patient ’s <span style="background-color:rgba(255,0,0,0.3)">treatment--</span>   <span style="background-color:rgba(255,0,0,0.3)">the</span> <span style="background-color:rgba(255,0,0,0.3)">suspect</span> <span style="background-color:rgba(255,0,0,0.3)">,</span> <span style="background-color:rgba(255,0,0,0.3)">a</span> <span style="background-color:rgba(255,0,0,0.3)">27-year</span> <span style="background-color:rgba(255,0,0,0.3)">-</span> <span style="background-color:rgba(255,0,0,0.3)">old</span> <span style="background-color:rgba(255,0,0,0.3)">man</span> <span style="background-color:rgba(255,0,0,0.3)">,</span> <span style="background-color:rgba(255,0,0,0.3)">had</span> <span style="background-color:rgba(255,0,0,0.3)">no</span> <span style="background-color:rgba(255,0,0,0.3)">known</span> <span style="background-color:rgba(255,0,0,0.3)">conflict</span> <span style="background-color:rgba(255,0,0,0.3)">with</span> <span style="background-color:rgba(255,0,0,0.3)">the</span> victims <span style="background-color:rgba(255,0,0,0.3)">,</span> <span style="background-color:rgba(255,0,0,0.3)">who</span> were killed in a women ’s dormitory at the hospital               , the  <span style="background-color:rgba(255,0,0,0.3)">Qinhuangdao</span> <span style="background-color:rgba(255,0,0,0.3)">City</span> <span style="background-color:rgba(255,0,0,0.3)">Public</span> <span style="background-color:rgba(255,0,0,0.3)">Security</span> <span style="background-color:rgba(255,0,0,0.3)">Bureau</span> said <span style="background-color:rgba(255,0,0,0.3)">in</span> <span style="background-color:rgba(255,0,0,0.3)">a</span> <span style="background-color:rgba(255,0,0,0.3)">statement</span> <span style="background-color:rgba(255,0,0,0.3)">online</span> . &rarr;</p>
                            <hr>
                            <p>The                                              suspect , a 27-year - old   <span style="background-color:rgba(0,255,0,0.3)">hospital </span> <span style="background-color:rgba(0,255,0,0.3)">employee </span> <span style="background-color:rgba(0,255,0,0.3)">who </span> had no known   <span style="background-color:rgba(0,255,0,0.3)">motive </span> <span style="background-color:rgba(0,255,0,0.3)">, </span> <span style="background-color:rgba(0,255,0,0.3)">was </span> <span style="background-color:rgba(0,255,0,0.3)">arrested </span> <span style="background-color:rgba(0,255,0,0.3)">after </span> the <span style="background-color:rgba(0,255,0,0.3)">attacks </span>              , the Qinhuangdao City Public Security Bureau said in a statement online .</p>
                            <p>The <span style="background-color:rgba(0,255,0,0.3)">stabbings </span> <span style="background-color:rgba(0,255,0,0.3)">took </span> <span style="background-color:rgba(0,255,0,0.3)">place </span>        Thursday morning in Beidaihe , a resort area in the Hebei Province city of Qinhuangdao , <span style="background-color:rgba(0,255,0,0.3)">about </span> <span style="background-color:rgba(0,255,0,0.3)">180 </span> <span style="background-color:rgba(0,255,0,0.3)">miles </span> <span style="background-color:rgba(0,255,0,0.3)">east </span>              of <span style="background-color:rgba(0,255,0,0.3)">Beijing </span>                                                .</p>
                            <p>   <span style="background-color:rgba(0,255,0,0.3)">But </span> <span style="background-color:rgba(0,255,0,0.3)">the </span> <span style="background-color:rgba(0,255,0,0.3)">fact </span> <span style="background-color:rgba(0,255,0,0.3)">that </span> the suspect in the     Beidaihe <span style="background-color:rgba(0,255,0,0.3)">case </span>             is <span style="background-color:rgba(0,255,0,0.3)">an </span>   employee   <span style="background-color:rgba(0,255,0,0.3)">indicates </span> <span style="background-color:rgba(0,255,0,0.3)">that </span> the attack was  <span style="background-color:rgba(0,255,0,0.3)">probably </span> not the result of a dispute over a patient ’s <span style="background-color:rgba(0,255,0,0.3)">treatment </span>                                         .</p>
                            <p>The                                                            victims   were killed in a women ’s dormitory at the hospital <span style="background-color:rgba(0,255,0,0.3)">for </span> <span style="background-color:rgba(0,255,0,0.3)">elderly </span> <span style="background-color:rgba(0,255,0,0.3)">military </span> <span style="background-color:rgba(0,255,0,0.3)">personnel </span> <span style="background-color:rgba(0,255,0,0.3)">, </span> <span style="background-color:rgba(0,255,0,0.3)">also </span> <span style="background-color:rgba(0,255,0,0.3)">known </span> <span style="background-color:rgba(0,255,0,0.3)">as </span> <span style="background-color:rgba(0,255,0,0.3)">People </span> <span style="background-color:rgba(0,255,0,0.3)">’s </span> <span style="background-color:rgba(0,255,0,0.3)">Liberation </span> <span style="background-color:rgba(0,255,0,0.3)">Army </span> <span style="background-color:rgba(0,255,0,0.3)">Hospital </span> <span style="background-color:rgba(0,255,0,0.3)">281 </span> , the <span style="background-color:rgba(0,255,0,0.3)">statement </span>      said     .</p>
                        </div>


                    </div>
                </div>
              </div>
            </div>
            </div>
        </div>
    <br>
    <hr class="hr-medium">
    <br>
    <h2><u>Task:</u></h2>
    <p><em>Right click and select "Remove" for all connections between sentences that do NOT match.
       <br>Read above for more detailed instructions and examples.</em></p>
    <br>
<!--    <h4>Headline: {{ headline }}</h4>-->
    <p>Article Key: {{ doc_id }}</p>
    <br>
    <div class="row header" >
        <div class="col-4" doc_id="{{ doc_id }}" ><h3>Article</h3></div>
        <div class="col-8" doc_id="{{ doc_id }}" ></div>
    </div>
    <div class="row text" >
        <div class="col-4 textblock_pool" doc_id="{{ doc_id }}" ></div>
        <div class="col-8 questions" doc_id="{{ doc_id }}" ></div>
    </div>
    <div class="row annotation">
	    <div class="error question col-4" doc_id="{{ doc_id }}" error_type='error'>
		  <p>
    	  <h4>Does this article have errors?</h4>
    	  <div id="error_btn_grp" class="btn-group-vertical btn-group-toggle" role="group" data-toggle="buttons">
              <div class="btn-group">
                <label class="btn btn-outline-success btn-sm active" label="legit">
                    <input type="radio" name="options" autocomplete="off" checked>No errors</label>
                <label class="btn btn-outline-danger btn-sm" label="incom_sentence">
                 <input type="radio" name="options" autocomplete="off" checked>Incomplete Sentences</label>
              </div>
              <div class="btn-group">
                <label class="btn btn-outline-danger btn-sm" label="other" id="otherbutton">
                    <input type="radio" name="options" autocomplete="off" checked>Other</label>
                <input id="otherform" type="text" class="form-control hidden"
                       aria-label="Text input with radio button" placeholder="Specify...">
              </div>
		  </div>
		  </p>
		</div>
	    <div class="error question col-4" doc_id="{{ doc_id }}" error_type='confidence'>
		  <p>
    	  <h4>How confident are you in this tagging?</h4>
    	  <div class="btn-group-vertical btn-group-toggle" role="group" data-toggle="buttons">
              <div class="btn-group">
                <label class="btn btn-outline-success btn-sm" label="redo">
                    <input type="radio" name="options" autocomplete="off" checked>1 - Needs Redo</label>
                <label class="btn btn-outline-success btn-sm" label="check">
                    <input type="radio" name="options" autocomplete="off" checked>2 - Needs Check</label>
                <label class="btn btn-outline-success btn-sm" label="glance">
                    <input type="radio" name="options" autocomplete="off" checked>3 - Needs Glance</label>
              </div>
              <div class="btn-group">
                <label class="btn btn-outline-success btn-sm active" label="ok">
                    <input type="radio" name="options" autocomplete="off" checked>4 - Should be OK</label>
                <label class="btn btn-outline-success btn-sm" label="perfect">
                    <input type="radio" name="options" autocomplete="off" checked>5 - Confident</label>
              </div>
		  </div>
		 </p>
		</div>
		 </p>
      </div>
    </div>

<div id=moving_div></div> <!-- small div to track with the line. -->
<input type='hidden' value='' name='data' id='data'/>
<div class="container">
    <div class="row">
        <input class="btn btn-outline-success" type='submit' id='submitButton' value='Submit'>
    </div>
<hr>
    <div class="row">
        <div class="col-12">
        <h3>Optional Feedback:</h3>
            <p>
            We'd love to hear some feedback on this task: if any parts were confusing, or the task itself could
            be formulated better, we'd love to hear any comments, ideas or suggestions. We really appreciate your help!
            </p>
        </div>
        <hr>
        <div class="col-12">
            <textarea type='text' value='' name='feedback' id='feedback' placeholder='Optional feedback here...'></textarea>
        </div>
    </div>
</div>
</form>

<script language='Javascript'>

    $('#otherbutton').on('click', function(d){
        $('#otherform').removeClass('hidden')
    })

    $('#otherform').on('click', function(d){
        $('#error_btn_grp').find('label').removeClass('active')
        $('#otherbutton').addClass('active')
    })

    $('#otherbutton2').on('click', function(d){
        $('#otherform2').removeClass('hidden')
    })

    $('#otherform2').on('click', function(d){
        $('#law_type_btn_grp').find('label').removeClass('active')
        $('#otherbutton2').addClass('active')
    })

    var window_height = $( window ).height();
    String.prototype.replaceAll = function(search, replacement) {
        var target = this;
        return target.replace(new RegExp(search, 'g'), replacement);
    };
    String.prototype.toTitleCase = function() {
        var target = this;
        return target.replace(/(?:^|\s)\w/g, function(match) {
            return match.toUpperCase();
        });
    };
    Array.prototype.remove_duplicates = function() {
        var arr = this;
        let s = new Set(arr);
        let it = s.values();
        return Array.from(it);
    };

    (function(old) {
      $.fn.attr = function() {
        if(arguments.length === 0) {
          if(this.length === 0) {
            return null;
          }

          var obj = {};
          $.each(this[0].attributes, function() {
            if(this.specified) {
              obj[this.name] = this.value;
            }
          });
          return obj;
        }

        return old.apply(this, arguments);
      };
    })($.fn.attr);

    // page handling
    class PageManager {
	constructor(
	    textblock_dim,
        demo,
        check,
        doc_key,
        dropdown_buttons,
        textblock_pool_min
	) {
		this.demo = demo
		this.check = check
		this.doc_key = doc_key
		// dropdown buttons
		this.dropdown_buttons = dropdown_buttons
		// dimensions for textblock divs
		this.textblock_pool_min = textblock_pool_min
		this.textblock_dim = textblock_dim;
		this.start_line_id = null
		// z-index for dropdown needs to increase every click :/ maybe not the best implementation
		this.curr_dropdown_zindex = 3
	}

    create_original_textblock(selected_text, block_type, block_id){
    	var that = this

        // create textblock element for the righthand side
        var textblock_pool = $('.textblock_pool').filter(
            function (d) {
                return $(d).attr('doc_id') == this.doc_key
            }
        )

        // slot
        var textblock_row = document.createElement('div')
        $(textblock_row)
            .addClass('row')
            .addClass('textblock-row')


        // draggable div
        var textblock_div = document.createElement('div')
        $(textblock_div)
        	.addClass('textblock')
        	.attr('doc_id', that.doc_key)
	       	.attr('id', 'sentence-' + block_id)
	       	.attr('label', block_type)

        // text content
        var textblock_span = document.createElement('span')
        $(textblock_span).addClass('textblock_span')
        textblock_span.textContent = selected_text

        // append elements to the textblock
        $(textblock_div).append(textblock_span)
		$(textblock_div).draggable({
            'snap': '.slot-' + block_id,
            'snapMode': 'inner',
            'snapTolerance': 30
        });


        var deleted_text = document.createElement('span')
        $(deleted_text).addClass('deleted-text')
        deleted_text.textContent = selected_text
        var deleted_text_div = document.createElement('div')
        $(deleted_text_div).addClass('deleted-text-div').addClass('hidden-none')
        $(deleted_text_div).append(deleted_text)
        var textblock_snap = document.createElement('div')
        $(textblock_snap)
            .addClass('textblock-snap')
            .addClass('slot-' + block_id)
            .attr('accepted-textblock', 'sentence-' + block_id)
            .droppable({
                out: function(event, ui){
                    if ($(this).attr('accepted-textblock') == $(ui.draggable).attr('id')) {
                        $(this).find('.deleted-text-div').removeClass('hidden-none')
                        $(this).css('height', $(this).find('.deleted-text-div').css('height'))
                        $('.textblock-potential').parent().removeClass('color-none')
                    }
                },
                drop: function(event, ui){
                    if ($(this).attr('accepted-textblock') == $(ui.draggable).attr('id')){
                        $(this).find('.deleted-text').addClass('color-none')
                    }
                }
            })

        // append textblock to the pool of textblocks
        $(textblock_snap).append(deleted_text_div)
        $(textblock_snap).append(textblock_div)
    	$(textblock_row).append(textblock_snap)
    	$(textblock_row).appendTo(textblock_pool)

        // dynamically resize the height of the textblock pool
        var multiplier = 2
	    var new_height = d3.sum(
	        textblock_pool.find('.textblock').map(function(i, d){
     			return $(d).height() + multiplier * (
 	    		    that.textblock_dim.margin + that.textblock_dim.border + that.textblock_dim.padding
                ) // 2 * (margin + border + padding)
 		}))

       $(textblock_pool).css('height', d3.max([this.textblock_pool_min, new_height]))
    }

    create_potential_slot(){
        var that = this;

        // create textblock element for the righthand side
        var textblock_pool = $('.textblock_pool').filter(
            function (d) {
                return $(d).attr('doc_id') == this.doc_key
            }
        )

        // slot
        var textblock_row = document.createElement('div')
        $(textblock_row)
            .addClass('color-none')
            .addClass('textblock-potential-row')

        // draggable div
        var textblock_potential_div = document.createElement('div')
        $(textblock_potential_div)
        	.addClass('textblock-potential')
        	.attr('doc_id', that.doc_key)

        $(textblock_row).append(textblock_potential_div)
        $(textblock_pool).append(textblock_row)

        $(textblock_row).droppable({
            drop: function(event, ui){
                $(this).find('.textblock-potential').append(ui.draggable)
            },
            out: function(event, ui){
                $(this)
                    .removeClass('textblock-potential-active')
                    .addClass('textblock-potential-row')
                $(this).css('height', 30)
            },
            over: function (event, ui) {
                $(this)
                    .removeClass('textblock-potential-row')
                    .addClass('textblock-potential-active')
                $(this).css('height', parseInt(ui.draggable.css('height')) + 20)
            }
        })
    }
}

    textblock_dims = {
		'margin': 5,
		'border': 2,
		'padding': 10
	}

	textblock_pool_min_height = 200

    buttons = [
		['NODE', 'btn-outline-primary', 'node'],
    ]
    pm = new PageManager(
		textblock_dims, false, false,
		"{{ doc_id }}", buttons,
		textblock_pool_min_height
	)

    data = JSON.parse('{{ data | tojson | safe }}'.replaceAll('NaN', 'null'))
    $(data.nodes).each(function (i, d) {
       pm.create_original_textblock(d.sentence, 'NODE', d.sent_idx)
        pm.create_potential_slot()
    })

    $('.textblock')
        .on('mouseover', function(){})
        .on('mouseout',  function(){})

    //
    // mturk
    //
    // handle data
    //
    class SubmitHandler{
        constructor() {
            turkSetAssignmentID();
            this.GENERIC_THANKS_MESSAGE = 'Thank you so much for your help with our task!'
            this.completed_checks = false
        }

        _format_data(d, question_class){
            return {
                "doc_id": "{{ doc_id }}",
                "question_class": question_class,
                "sent_idx_x": $('.' + d).attr('left').split('-')[2],
                "sent_idx_y": $('.' + d).attr('right').split('-')[2],
                'version_x': x_vers,
                'version_y': y_vers,
            }
        }

        get_data_from_dom() {
            var that = this
            that.num_x_nodes = x_nodes.length
            that.num_y_nodes = y_nodes.length
            that.num_nodes_min = Math.min(that.num_x_nodes, that.num_y_nodes)
            that.output = {
                'doc_id': "{{ doc_id }}",
                'annotated connections': [],
                'nodes': data.nodes,
                'original_arcs': data.arcs
            }

            var lines_at_end = []
            $('.connection.annotated').each(function (i, d) {
                lines_at_end.push(
                    $(d).attr('class')
                        .split(/\s+/)
                        .filter(function (d) {
                            return d.indexOf('line') != -1
                        })[0]
                )
            })

            // put in this class
            lines_at_end.forEach(function(d){
                that.output['annotated connections'].push(that._format_data(d, 'connections annotated'))
            })
            this.num_lines_added = lines_at_end.length
            this.output['num_connections_added'] = lines_at_end.length
        }

        gather_and_submit_data(submit_button, submit_click_event) {
            this.submit_button = submit_button
            this.submit_click_event = submit_click_event
            this.get_data_from_dom()
            this.first_check() // -> second_confirm -> third_confirm -> submit_data
        }

        first_check(){
            var that = this
            {% if production == True %}
            // First question
            if (this.num_lines_added == 0){
                alertify.alert(
                    "You've annotated 0 connections. We believe this is highly unlikely and indicative of being a spammer. " +
                    "Please note, we will be blocking and reporting workers who show spammer-like behavior."
                )
                return
            }

            if (that.num_lines_added / that.num_nodes_min < .5){
                alertify.alert(
                    "You've drawn connections between annotated less than 50% of the nodes. We believe this is highly unlikely and indicative of being a spammer. " +
                    "Please note, we will be blocking and reporting workers who show spammer-like behavior."
                )
                return
            }
            {% endif %}
            alertify.confirm(
                    "You\'ve added " + this.num_lines_added + " lines. Is this correct?",
            ).set('header', '<em>Checking number of connections drawn...</em>')
             .set('labels', {
                        ok: "Continue, submit!",
                        cancel: "Let me recheck..."
                    })
                 .set('onok', function () {
                        that.second_check()
                    })
                 .set('oncancel', function() {
                        alertify.error('Thanks for being diligent! Please recheck and resubmit!')
                    })
        }

        second_check(){
            var that = this
            setTimeout(function() {
                var word_diff_ratios = $('.connection.annotated').map(function (i, d) {
                    return $(d).attr('word-diff-ratio')
                })
                var low_ratios = word_diff_ratios.filter(function (i, d) {return d < .2})
                // Second Question.
                if (low_ratios.length > 0) {
                    alertify.confirm(
                        /* message */ low_ratios.length + " connections have very low word-overlap. Are you sure they are correct?",
                    )
                        .set('header', '<em>Checking all word overlaps...</em>')
                        .set('labels', {
                            ok: "Continue, submit!",
                            cancel: "Let me recheck..."
                        })
                        .set('onok', function () {
                            that.third_check()
                        })
                        .set('oncancel', function () {
                            alertify.error('Thanks for being diligent! Please recheck and resubmit!')
                        })
                        // .set('onclose', function () { });
                 // otherwise, skip straight to the final confirm
                } else {
                    that.third_check()
                }
            }, 700)
        }

        third_check(){
            var that = this
            setTimeout(function() {
                alertify.confirm(
                    "Great! Your submission is valid. Do you want to recheck your answers?"
                ).set('header', '<em>Looks good! Ready to Submit?</em>')
                    .set('labels', {
                        ok: "Continue, submit!",
                        cancel: "Let me recheck..."
                    })
                    .set('onok', function () {
                        alertify.success('Ok! Submitting...')
                        alertify.success(that.GENERIC_THANKS_MESSAGE)
                        that.record_data()
                    })
                    .set('oncancel', function () {
                        alertify.error('Thanks for being diligent! Please recheck and resubmit!')
                    })
            }, 700)
        }
        record_data(){
            {% if do_mturk %}
            // submit mturk
            $('#data').attr('value', JSON.stringify(this.output))
            this.completed_checks = true
            $(this.submit_button).trigger(this.submit_click_event.type);
            {% else %}
            // submit AJAX
            this.output['start_time'] = "{{ start_time }}"
            $.ajax({
                url: "/post_task",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(this.output),
                success: function (result) {
                    if (result === "success") location.href = "/view_task_scratch"
                }
            })
            {% endif %}
        }
    }

    // submit button click
    var sh = new SubmitHandler()
    $('#submitButton').on('click', function(submit_click_event){
        var submit_button = this
        if (! sh.completed_checks) {
            submit_click_event.preventDefault();
            sh.gather_and_submit_data(submit_button, submit_click_event);
        }
    })

</script>
</body></html>
<!-- YOUR HTML ENDS -->

]]>
</HTMLContent>
<FrameHeight>600</FrameHeight>
</HTMLQuestion>